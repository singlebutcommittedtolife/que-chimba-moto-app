{"ast":null,"code":"import Footer from'../../components/footer/Footer';import Header from'../../components/header/Header';import React,{useState,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import{createClient}from'../../services/clientService';import{generateTicket}from'../../services/ticketPurchaseService';import{getActiveRaffle}from'../../services/raffleService';import{createTransaction}from'../../services/transactionService';import{validateTransactionOnServer}from'../../services/transactionService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Purchase=()=>{const location=useLocation();const queryParams=new URLSearchParams(location.search);const initialQuantity=parseInt(queryParams.get('quantity'))||1;const[raffleNumber,setRaffleNumber]=useState(0);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const publicKey=process.env.REACT_APP_WOMPI_API_KEY_PUB;const[selectedRaffles,setSelectedRaffles]=useState([]);// Inicializa como un arreglo\nconst navigate=useNavigate();const[totalAmount,setTotalAmount]=useState(0);const[formData,setFormData]=useState({nombre:'',apellidos:'',tipoDocumento:'',documento:'',direccion:'',ciudad:'',telefono:'',correo:''});// Nuevo useEffect para cargar la rifa al entrar en la aplicación\nuseEffect(()=>{console.log(\"useEffect 1\");console.log(\"wompy key \"+publicKey);const fetchRaffle=async()=>{try{const data=await getActiveRaffle();// Llama al servicio\nsetSelectedRaffles([{id:data.id,name:data.nameRaffle,price:data.price,quantity:initialQuantity}]);setLoading(false);}catch(err){setError('Error al cargar los datos de la rifa');setLoading(false);}};fetchRaffle();// Llamada al servicio al montar el componente\n},[]);// El array vacío asegura que esto se ejecuta solo una vez\nuseEffect(()=>{console.log(\"useEffect 2\");calculateTotal();},[selectedRaffles]);const calculateTotal=()=>{var _selectedRaffles$;const total=selectedRaffles.reduce((sum,raffle)=>{const price=parseFloat(raffle.price['$numberDecimal']);// Convertir `$numberDecimal` a número\nconst quantity=raffle.quantity||0;// Usar 0 como valor predeterminado para quantity\nreturn sum+price*quantity;},0);setTotalAmount(total);const quantity=((_selectedRaffles$=selectedRaffles[0])===null||_selectedRaffles$===void 0?void 0:_selectedRaffles$.quantity)||0;setRaffleNumber(quantity);// Usar `setRaffleNumber` para actualizar la variable de estado\nconsole.log('raffleNumer'+raffleNumber);};const handleQuantityChange=(id,newQuantity)=>{setSelectedRaffles(prevRaffles=>prevRaffles.map(raffle=>raffle.id===id?{...raffle,quantity:Math.max(1,newQuantity)}:raffle));};const handleRemoveRaffle=id=>{setSelectedRaffles(prevRaffles=>prevRaffles.filter(raffle=>raffle.id!==id));};const handleChange=e=>{const{name,value}=e.target;// Verificar si el campo es 'nombre' o algún campo que deba permitir solo letras\nif(name===\"nombre\"||name===\"apellidos\"||name===\"ciudad\"){// Usar expresión regular para permitir solo letras, acentos y espacios\nconst onlyLetters=value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\\s]/g,\"\");setFormData(prevState=>({...prevState,[name]:onlyLetters// Actualizar el valor con solo letras\n}));}else{// Si no es un campo restringido, actualizar normalmente\nsetFormData(prevState=>({...prevState,[name]:value}));}};const createNewClient=async()=>{const clientData={user:{id:formData.documento,name:formData.nombre,lastName:formData.apellidos,documentType:formData.tipoDocumento,documentNumber:formData.documento,address:{country:\"Colombia\",street:formData.direccion,city:formData.ciudad},cellphone:formData.telefono,email:formData.correo,registryDate:new Date(),registryUser:\"chimbaMoto\"}};try{const newClient=await createClient(clientData);console.log(\"Cliente creado:\",newClient);return newClient;}catch(error){console.error(\"Error al crear el cliente:\",error);throw new Error(\"Error al crear el cliente\");}};const generateTicketsForClient=async clientId=>{try{let remainingTickets=raffleNumber;while(remainingTickets>0){const ticketPurchaseData={raffleNumber:\"123\",// Reemplazar con lógica real si es necesario\nclientId,registryDate:new Date(),registryUser:\"chimbaMoto\"};const newTicketPurchase=await generateTicket(ticketPurchaseData);console.log(\"Ticket Purchase creado:\",newTicketPurchase);remainingTickets--;}}catch(error){console.error(\"Error al generar los tickets:\",error);throw new Error(\"Error al generar los tickets\");}};const handleWompiPayment=()=>{const checkout=new window.WidgetCheckout({currency:'COP',amountInCents:5000*100,// Monto de prueba\nreference:`transaction-${Date.now()}`,// Referencia única\npublicKey:publicKey// Llave pública de Sandbox\n});// Abrir el widget para obtener el token de la tarjeta\ncheckout.open(async result=>{const transaction=result.transaction;console.log(\"transaction \"+transaction);if(transaction.status==='APPROVED'){console.log('Token generado:',transaction.payment_method);try{// Llamar al servicio para crear la transacción\nconst data=await createTransaction({totalAmount:totalAmount,// Monto total en COP\ncustomerEmail:'cliente@ejemplo.com',// Reemplaza con el correo del usuario\npaymentToken:transaction.payment_method.token// Token generado por el widget\n});if(data.error){alert('Error al procesar el pago en el servidor: '+data.message);}else{alert('Pago aprobado en el servidor: '+data.data.id);}}catch(error){console.error('Error al enviar la transacción al servidor:',error);alert('Error en la comunicación con el servidor.');}}else{alert('Transacción rechazada: '+transaction.status);}setLoading(false);});};const processPaymentWithWompi=()=>{console.log(\"Bienvenida hija\");return new Promise((resolve,reject)=>{const checkout=new window.WidgetCheckout({currency:\"COP\",amountInCents:totalAmount*100,reference:`transaction-${Date.now()}`,publicKey:publicKey// Llave pública de Sandbox\n});console.log(\"Bienvenida hija 2\");checkout.open(async result=>{const transaction=result.transaction;if(transaction.status===\"APPROVED\"){console.log(\"Transacción aprobada en Wompi:\",transaction);// Validar la transacción en el servidor\ntry{const isValid=await validateTransactionOnServer(transaction.id);// Método para validar en tu backend\nif(isValid){resolve(transaction);// Transacción confirmada\n}else{reject(new Error(\"Validación fallida en el servidor\"));}}catch(error){console.error(\"Error en la validación del servidor:\",error);reject(error);}}else{console.error(\"Transacción rechazada o fallida:\",transaction.status);reject(new Error(`Transacción rechazada: ${transaction.status}`));}});});};const createTransactionRecord=async transaction=>{try{const transactionDetails={reference:`transaction-${transaction.registryDate}`,name:formData.nombre,totalAmount:totalAmount,date:new Date()};await createTransaction(transactionDetails);console.log(\"Transacción registrada:\",transactionDetails);}catch(error){console.error(\"Error al registrar la transacción:\",error);throw new Error(\"Error al registrar la transacción\");}};const handleSubmit=async e=>{e.preventDefault();try{console.log(\"Iniciando proceso de compra...\");// Paso 1: Crear cliente\nconst newClient=await createNewClient();// Paso 2: Generar tickets\nawait generateTicketsForClient(newClient._id);// Paso 3: Procesar pago con Wompi\nconst transaction=await processPaymentWithWompi();// Paso 4: Registrar transacción\nawait createTransactionRecord(transaction);// Redireccionar a la página de confirmación\nnavigate(\"/confirmation\",{state:{totalAmount}});}catch(error){console.error(\"Error en el proceso de compra:\",error.message);// Aquí podrías mostrar un mensaje de error al usuario\n}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-center mb-6\",children:\"Compra de Tickets\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col lg:flex-row gap-8\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"lg:w-1/2 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"nombre\",children:\"Nombre\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"nombre\",type:\"text\",name:\"nombre\",pattern:\"[a-zA-Z\\xE1\\xE9\\xED\\xF3\\xFA\\xC1\\xC9\\xCD\\xD3\\xDA\\xF1\\xD1\\\\s]+\",maxLength:50,value:formData.nombre,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"apellidos\",children:\"Apellidos\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"apellidos\",type:\"text\",maxLength:50,name:\"apellidos\",value:formData.apellidos,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"tipoDocumento\",children:\"Tipo de Documento\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"tipoDocumento\",name:\"tipoDocumento\",value:formData.tipoDocumento,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"CC\",children:\"C\\xE9dula de Ciudadan\\xEDa\"}),/*#__PURE__*/_jsx(\"option\",{value:\"CE\",children:\"C\\xE9dula de Extranjer\\xEDa\"}),/*#__PURE__*/_jsx(\"option\",{value:\"PP\",children:\"Pasaporte\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"documento\",children:\"N\\xFAmero de Documento\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"documento\",type:\"text\",maxLength:15,name:\"documento\",value:formData.documento,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"direccion\",children:\"Direcci\\xF3n\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"direccion\",type:\"text\",name:\"direccion\",value:formData.direccion,maxLength:50,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"ciudad\",children:\"Ciudad\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"ciudad\",type:\"text\",maxLength:20,name:\"ciudad\",value:formData.ciudad,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"telefono\",children:\"Tel\\xE9fono\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"telefono\",type:\"tel\",name:\"telefono\",maxLength:16,value:formData.telefono,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"correo\",children:\"Correo Electr\\xF3nico\"}),/*#__PURE__*/_jsx(\"input\",{className:\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\",id:\"correo\",type:\"email\",name:\"correo\",maxLength:80,value:formData.correo,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\",type:\"submit\",children:\"Comprar Tickets\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"lg:w-1/2 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Tus Fondos Seleccionados\"}),selectedRaffles.map(raffle=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"span\",{children:raffle.name}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleQuantityChange(raffle.id,raffle.quantity-1),className:\"bg-gray-200 px-2 py-1 rounded\",children:\"-\"}),/*#__PURE__*/_jsx(\"span\",{className:\"mx-2\",children:raffle.quantity}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleQuantityChange(raffle.id,raffle.quantity+1),className:\"bg-gray-200 px-2 py-1 rounded\",children:\"+\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveRaffle(raffle.id),className:\"ml-4 text-red-500\",children:\"Eliminar\"})]})]},raffle.id)),/*#__PURE__*/_jsxs(\"p\",{className:\"text-lg font-bold mt-4\",children:[\"Total a pagar: $\",totalAmount.toLocaleString()]})]})]})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default Purchase;","map":{"version":3,"names":["Footer","Header","React","useState","useEffect","useNavigate","useLocation","createClient","generateTicket","getActiveRaffle","createTransaction","validateTransactionOnServer","jsx","_jsx","jsxs","_jsxs","Purchase","location","queryParams","URLSearchParams","search","initialQuantity","parseInt","get","raffleNumber","setRaffleNumber","loading","setLoading","error","setError","publicKey","process","env","REACT_APP_WOMPI_API_KEY_PUB","selectedRaffles","setSelectedRaffles","navigate","totalAmount","setTotalAmount","formData","setFormData","nombre","apellidos","tipoDocumento","documento","direccion","ciudad","telefono","correo","console","log","fetchRaffle","data","id","name","nameRaffle","price","quantity","err","calculateTotal","_selectedRaffles$","total","reduce","sum","raffle","parseFloat","handleQuantityChange","newQuantity","prevRaffles","map","Math","max","handleRemoveRaffle","filter","handleChange","e","value","target","onlyLetters","replace","prevState","createNewClient","clientData","user","lastName","documentType","documentNumber","address","country","street","city","cellphone","email","registryDate","Date","registryUser","newClient","Error","generateTicketsForClient","clientId","remainingTickets","ticketPurchaseData","newTicketPurchase","handleWompiPayment","checkout","window","WidgetCheckout","currency","amountInCents","reference","now","open","result","transaction","status","payment_method","customerEmail","paymentToken","token","alert","message","processPaymentWithWompi","Promise","resolve","reject","isValid","createTransactionRecord","transactionDetails","date","handleSubmit","preventDefault","_id","state","children","className","onSubmit","htmlFor","type","pattern","maxLength","onChange","required","onClick","toLocaleString"],"sources":["C:/Users/miche/Documents/PaginasWeb/que-chimba-moto-app/client/src/pages/purchase/Purchase.js"],"sourcesContent":["import Footer from '../../components/footer/Footer'\r\nimport Header from '../../components/header/Header'\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate,useLocation } from 'react-router-dom';\r\nimport { createClient } from '../../services/clientService';  \r\nimport { generateTicket } from '../../services/ticketPurchaseService';  \r\nimport { getActiveRaffle } from '../../services/raffleService';  \r\nimport { createTransaction } from '../../services/transactionService';  \r\nimport { validateTransactionOnServer } from '../../services/transactionService';  \r\n\r\nconst Purchase = () => {\r\n\r\n  const location = useLocation();\r\n  const queryParams = new URLSearchParams(location.search);\r\n  \r\n  const initialQuantity = parseInt(queryParams.get('quantity')) || 1;\r\n  const [raffleNumber,setRaffleNumber] = useState(0);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const publicKey = process.env.REACT_APP_WOMPI_API_KEY_PUB;\r\n\r\n  const [selectedRaffles, setSelectedRaffles] = useState([]); // Inicializa como un arreglo\r\n\r\n  const navigate = useNavigate();\r\n  const [totalAmount, setTotalAmount] = useState(0);\r\n  const [formData, setFormData] = useState({\r\n    nombre: '',\r\n    apellidos: '',\r\n    tipoDocumento: '',\r\n    documento: '',\r\n    direccion: '',\r\n    ciudad: '',\r\n    telefono: '',\r\n    correo: ''\r\n  });\r\n\r\n\r\n   // Nuevo useEffect para cargar la rifa al entrar en la aplicación\r\n   useEffect(() => {\r\n    console.log(\"useEffect 1\")\r\n    console.log(\"wompy key \"+publicKey);\r\n\r\n    const fetchRaffle = async () => {\r\n      try {\r\n        const data = await getActiveRaffle(); // Llama al servicio\r\n        setSelectedRaffles([\r\n          {\r\n            id: data.id,\r\n            name: data.nameRaffle,\r\n            price: data.price,\r\n            quantity: initialQuantity\r\n          }\r\n        ]);\r\n        setLoading(false);\r\n      } catch (err) {\r\n        setError('Error al cargar los datos de la rifa');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRaffle(); // Llamada al servicio al montar el componente\r\n  }, []); // El array vacío asegura que esto se ejecuta solo una vez\r\n\r\n  \r\n  useEffect(() => {\r\n    console.log(\"useEffect 2\")\r\n\r\n    calculateTotal();\r\n  }, [selectedRaffles]);\r\n\r\n\r\n  const calculateTotal = () => {\r\n\r\n    const total = selectedRaffles.reduce((sum, raffle) => {\r\n      const price = parseFloat(raffle.price['$numberDecimal']); // Convertir `$numberDecimal` a número\r\n      const quantity = raffle.quantity || 0; // Usar 0 como valor predeterminado para quantity\r\n      return sum + (price * quantity);\r\n    }, 0);\r\n\r\n    setTotalAmount(total);\r\n    const quantity=selectedRaffles[0]?.quantity || 0;\r\n    setRaffleNumber(quantity); // Usar `setRaffleNumber` para actualizar la variable de estado\r\n\r\n    console.log('raffleNumer'+raffleNumber)\r\n  };\r\n\r\n  const handleQuantityChange = (id, newQuantity) => {\r\n    setSelectedRaffles(prevRaffles =>\r\n      prevRaffles.map(raffle =>\r\n        raffle.id === id ? { ...raffle, quantity: Math.max(1, newQuantity) } : raffle\r\n      )\r\n    );\r\n  };\r\n\r\n\r\n\r\n  const handleRemoveRaffle = (id) => {\r\n    setSelectedRaffles(prevRaffles => prevRaffles.filter(raffle => raffle.id !== id));\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value } = e.target;\r\n    \r\n    // Verificar si el campo es 'nombre' o algún campo que deba permitir solo letras\r\n    if (name === \"nombre\" || name === \"apellidos\"||name === \"ciudad\") {\r\n      // Usar expresión regular para permitir solo letras, acentos y espacios\r\n      const onlyLetters = value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\\s]/g, \"\");\r\n      \r\n      setFormData(prevState => ({\r\n        ...prevState,\r\n        [name]: onlyLetters  // Actualizar el valor con solo letras\r\n      }));\r\n    } else {\r\n      // Si no es un campo restringido, actualizar normalmente\r\n      setFormData(prevState => ({\r\n        ...prevState,\r\n        [name]: value\r\n      }));\r\n    }\r\n  };\r\n    \r\n  const createNewClient = async () => {\r\n    const clientData = {\r\n      user: {\r\n        id: formData.documento,\r\n        name: formData.nombre,\r\n        lastName: formData.apellidos,\r\n        documentType: formData.tipoDocumento,\r\n        documentNumber: formData.documento,\r\n        address: {\r\n          country: \"Colombia\",\r\n          street: formData.direccion,\r\n          city: formData.ciudad,\r\n        },\r\n        cellphone: formData.telefono,\r\n        email: formData.correo,\r\n        registryDate: new Date(),\r\n        registryUser: \"chimbaMoto\",\r\n      },\r\n    };\r\n  \r\n    try {\r\n      const newClient = await createClient(clientData);\r\n      console.log(\"Cliente creado:\", newClient);\r\n      return newClient;\r\n    } catch (error) {\r\n      console.error(\"Error al crear el cliente:\", error);\r\n      throw new Error(\"Error al crear el cliente\");\r\n    }\r\n  };\r\n  \r\n  const generateTicketsForClient = async (clientId) => {\r\n    try {\r\n      let remainingTickets = raffleNumber;\r\n  \r\n      while (remainingTickets > 0) {\r\n        const ticketPurchaseData = {\r\n          raffleNumber: \"123\", // Reemplazar con lógica real si es necesario\r\n          clientId,\r\n          registryDate: new Date(),\r\n          registryUser: \"chimbaMoto\",\r\n        };\r\n  \r\n        const newTicketPurchase = await generateTicket(ticketPurchaseData);\r\n        console.log(\"Ticket Purchase creado:\", newTicketPurchase);\r\n  \r\n        remainingTickets--;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error al generar los tickets:\", error);\r\n      throw new Error(\"Error al generar los tickets\");\r\n    }\r\n  };\r\n  const handleWompiPayment = () => {\r\n    const checkout = new window.WidgetCheckout({\r\n        currency: 'COP',\r\n        amountInCents: 5000 * 100, // Monto de prueba\r\n        reference: `transaction-${Date.now()}`, // Referencia única\r\n        publicKey:publicKey// Llave pública de Sandbox\r\n    });\r\n\r\n    // Abrir el widget para obtener el token de la tarjeta\r\n    checkout.open(async (result) => {\r\n      const transaction = result.transaction;\r\n      console.log(\"transaction \"+transaction)\r\n      \r\n      if (transaction.status === 'APPROVED') {\r\n        console.log('Token generado:', transaction.payment_method);\r\n\r\n        try {\r\n          // Llamar al servicio para crear la transacción\r\n          const data = await createTransaction({\r\n            totalAmount: totalAmount, // Monto total en COP\r\n            customerEmail: 'cliente@ejemplo.com', // Reemplaza con el correo del usuario\r\n            paymentToken: transaction.payment_method.token, // Token generado por el widget\r\n          });\r\n\r\n          if (data.error) {\r\n            alert('Error al procesar el pago en el servidor: ' + data.message);\r\n          } else {\r\n            alert('Pago aprobado en el servidor: ' + data.data.id);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error al enviar la transacción al servidor:', error);\r\n          alert('Error en la comunicación con el servidor.');\r\n        }\r\n      } else {\r\n        alert('Transacción rechazada: ' + transaction.status);\r\n      }\r\n\r\n      setLoading(false);\r\n    });\r\n};\r\n  const processPaymentWithWompi = () => {\r\n    console.log(\"Bienvenida hija\")\r\n    return new Promise((resolve, reject) => {\r\n      const checkout = new window.WidgetCheckout({\r\n        currency: \"COP\",\r\n        amountInCents: totalAmount * 100,\r\n        reference: `transaction-${Date.now()}`,\r\n        publicKey:publicKey// Llave pública de Sandbox\r\n      });\r\n      console.log(\"Bienvenida hija 2\")\r\n  \r\n      checkout.open(async (result) => {\r\n        const transaction = result.transaction;\r\n  \r\n        if (transaction.status === \"APPROVED\") {\r\n          console.log(\"Transacción aprobada en Wompi:\", transaction);\r\n          \r\n          // Validar la transacción en el servidor\r\n          try {\r\n            const isValid = await validateTransactionOnServer(transaction.id); // Método para validar en tu backend\r\n            if (isValid) {\r\n              resolve(transaction); // Transacción confirmada\r\n            } else {\r\n              reject(new Error(\"Validación fallida en el servidor\"));\r\n            }\r\n          } catch (error) {\r\n            console.error(\"Error en la validación del servidor:\", error);\r\n            reject(error);\r\n          }\r\n        } else {\r\n          console.error(\"Transacción rechazada o fallida:\", transaction.status);\r\n          reject(new Error(`Transacción rechazada: ${transaction.status}`));\r\n        }\r\n      });\r\n    });\r\n  };\r\n  \r\n  \r\n  const createTransactionRecord = async (transaction) => {\r\n    try {\r\n      const transactionDetails = {\r\n        reference: `transaction-${transaction.registryDate}`,\r\n        name: formData.nombre,\r\n        totalAmount: totalAmount,\r\n        date: new Date(),\r\n      };\r\n  \r\n      await createTransaction(transactionDetails);\r\n      console.log(\"Transacción registrada:\", transactionDetails);\r\n    } catch (error) {\r\n      console.error(\"Error al registrar la transacción:\", error);\r\n      throw new Error(\"Error al registrar la transacción\");\r\n    }\r\n  };\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n  \r\n    try {\r\n      console.log(\"Iniciando proceso de compra...\");\r\n  \r\n      // Paso 1: Crear cliente\r\n      const newClient = await createNewClient();\r\n  \r\n      // Paso 2: Generar tickets\r\n      await generateTicketsForClient(newClient._id);\r\n  \r\n      // Paso 3: Procesar pago con Wompi\r\n      const transaction = await processPaymentWithWompi();\r\n  \r\n      // Paso 4: Registrar transacción\r\n      await createTransactionRecord(transaction);\r\n  \r\n      // Redireccionar a la página de confirmación\r\n      navigate(\"/confirmation\", { state: { totalAmount } });\r\n    } catch (error) {\r\n      console.error(\"Error en el proceso de compra:\", error.message);\r\n      // Aquí podrías mostrar un mensaje de error al usuario\r\n    }\r\n  };\r\n\r\n  \r\n\r\n  \r\n  return (\r\n    <div>\r\n      <Header/>\r\n\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n      <h1 className=\"text-3xl font-bold text-center mb-6\">Compra de Tickets</h1>\r\n      <div className=\"flex flex-col lg:flex-row gap-8\">\r\n{/* Formulario de Datos Personales */}\r\n<form onSubmit={handleSubmit} className=\"lg:w-1/2 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4\">\r\n      <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"nombre\">\r\n            Nombre\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"nombre\"\r\n            type=\"text\"\r\n            name=\"nombre\"\r\n            pattern=\"[a-zA-ZáéíóúÁÉÍÓÚñÑ\\s]+\" \r\n            maxLength={50}\r\n            value={formData.nombre}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"apellidos\">\r\n            Apellidos\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"apellidos\"\r\n            type=\"text\"\r\n            maxLength={50}\r\n            name=\"apellidos\"\r\n            value={formData.apellidos}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"tipoDocumento\">\r\n            Tipo de Documento\r\n          </label>\r\n          <select\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"tipoDocumento\"\r\n            name=\"tipoDocumento\"\r\n            value={formData.tipoDocumento}\r\n            onChange={handleChange}\r\n            required\r\n          >\r\n            <option value=\"\">Seleccione...</option>\r\n            <option value=\"CC\">Cédula de Ciudadanía</option>\r\n            <option value=\"CE\">Cédula de Extranjería</option>\r\n            <option value=\"PP\">Pasaporte</option>\r\n          </select>\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"documento\">\r\n            Número de Documento\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"documento\"\r\n            type=\"text\"\r\n            maxLength={15}\r\n            name=\"documento\"\r\n            value={formData.documento}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"direccion\">\r\n            Dirección\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"direccion\"\r\n            type=\"text\"\r\n            name=\"direccion\"\r\n            value={formData.direccion}\r\n            maxLength={50}\r\n\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"ciudad\">\r\n            Ciudad\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"ciudad\"\r\n            type=\"text\"\r\n            maxLength={20}\r\n            name=\"ciudad\"\r\n            value={formData.ciudad}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-4\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"telefono\">\r\n            Teléfono\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"telefono\"\r\n            type=\"tel\"\r\n            name=\"telefono\"\r\n            maxLength={16}\r\n            value={formData.telefono}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"mb-6\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"correo\">\r\n            Correo Electrónico\r\n          </label>\r\n          <input\r\n            className=\"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline\"\r\n            id=\"correo\"\r\n            type=\"email\"\r\n            name=\"correo\"\r\n            maxLength={80}\r\n            value={formData.correo}\r\n            onChange={handleChange}\r\n            required\r\n          />\r\n        </div>\r\n        <div className=\"flex items-center justify-between\">\r\n          <button \r\n            className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\"\r\n            type=\"submit\"\r\n          >\r\n            Comprar Tickets\r\n          </button>\r\n        </div>\r\n      </form>\r\n      {/* Lista de Rifas Seleccionadas */}\r\n      <div className=\"lg:w-1/2 bg-white shadow-md rounded px-8 pt-6 pb-8 mb-6\">\r\n      <h2 className=\"text-xl font-bold mb-4\">Tus Fondos Seleccionados</h2>\r\n      {selectedRaffles.map((raffle) => (\r\n          <div key={raffle.id} className=\"flex items-center justify-between mb-4\">\r\n            <span>{raffle.name}</span>\r\n            <div>\r\n              <button onClick={() => handleQuantityChange(raffle.id, raffle.quantity - 1)} className=\"bg-gray-200 px-2 py-1 rounded\">-</button>\r\n              <span className=\"mx-2\">{raffle.quantity}</span>\r\n              <button onClick={() => handleQuantityChange(raffle.id, raffle.quantity + 1)} className=\"bg-gray-200 px-2 py-1 rounded\">+</button>\r\n              <button onClick={() => handleRemoveRaffle(raffle.id)} className=\"ml-4 text-red-500\">Eliminar</button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n\r\n        <p className=\"text-lg font-bold mt-4\">Total a pagar: ${totalAmount.toLocaleString()}</p>\r\n      </div>\r\n\r\n      \r\n    </div>\r\n    </div>\r\n\r\n          <Footer/>      \r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Purchase;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}